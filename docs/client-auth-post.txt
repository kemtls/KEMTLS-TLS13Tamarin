Dear all,

We [1] are in the process of performing an automated symbolic analysis
of the TLS 1.3 specification draft (revision 10) using the Tamarin
prover [2], which is a tool for automated security protocol analysis.

While revision 10 does not yet appear to permit certificate-based client
authentication in PSK (and in particular resumption using PSK), we modelled
what we believe is the intended functionality. By enabling client
authentication either in the initial handshake, or with a post- handshake
signature over the handshake hash, our Tamarin analysis finds an attack. The
result is a complete breakage of client authentication, as the attacker can
impersonate a client when communicating with a server:

Suppose a client Alice performs an initial handshake with Charlie. Charlie,
masquerading as Alice, subsequently performs a handshake with Bob. Following a
PSK resumption, Bob requests authentication from Charlie (impersonating Alice).
Charlie then requests authentication from Alice, and the returned signature
will also be a valid signature for the session with Bob.

        Initial h/s                                      Initial h/s
     |<-------------->|                               |<-------------->|
     |  exchange PSK  |                               |  exchange PSK  |
     |                |                               |                |
     |Start PSK resume|                               |Start PSK resume|
     |--------------->|                               |--------------->|
     |client_random nc|                               |client_random nc|
     |                |                               |                |
     |  Accept resume |                               |  Accept resume |
Alice|<---------------|(as Charlie) Charlie (as Alice)|<---------------|Bob
     |server_random ns|                               |server_random ns|
     |                |                               |                |
     |                |                               |                |
     |Client auth req |                               |Client auth req |
     |<---------------|                               |<---------------|
     |                |                               |                |
     |  Client auth   |                               |  Client auth   |
     |--------------->|                               |--------------->|
       sign nc,ns,...                                  relay signature



This attack is possible because the client signature is over the handshake
hash, which only covers the nonces and other easily duplicated information,
and in particular does not contain the server certificate (because none is
presented in PSK mode [3]) or the server Finished.

While the modifications proposed in PR#316 [4] explicitly allow client
authentication in these contexts, it also redefines the client signature based
on a new "Handshake Context" value which includes the server Finished message.
Intuitively, this new definition appears to address the attack because the
attacker cannot transplant the Finished message between connections. We are
currently working towards a Tamarin proof that PR#316 indeed prevents our
attack.

Therefore we would like to support the inclusion of Finished as
part of the handshake context, in order to address this problem.

Many thanks,

Sam Scott

[1] Cas Cremers, Marko Horvat - University of Oxford;
    Thyla van der Merwe, Sam Scott - Royal Holloway, University of London.
[2] http://www.infsec.ethz.ch/research/software/tamarin.html
[3] Except in 0-RTT where the server's Certificate is explicitly
    included.
[4] https://github.com/tlswg/tls13-spec/pull/316/